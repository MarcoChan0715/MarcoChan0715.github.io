<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Apps Dashboard</title>

  <link rel="icon" type="image/png" href="icon.png">

  <link rel="stylesheet" href="Coursework.css" />
  <script src="https://kit.fontawesome.com/f65489be61.js" crossorigin="anonymous"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    /* =========================================
       APP-SPECIFIC STYLES ONLY
       ========================================= */
    
    /* Global Reset for App Content */
    body { font-family: 'Poppins', sans-serif; }
    * { box-sizing: border-box; }

    /* Dashboard Layout */
    .app-container { max-width: 1100px; margin: 0 auto; padding-top: 160px; padding-bottom: 50px; }
    
    .app-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 30px;
        padding: 20px;
        justify-items: center;
        animation: fadeIn 0.5s ease;
    }

    .app-icon {
        width: 140px; height: 140px;
        background: white; border-radius: 28px;
        box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;
        border: 1px solid rgba(0,0,0,0.05); text-align: center; padding: 10px;
    }
    .app-icon:hover { transform: translateY(-5px); box-shadow: 0 15px 35px rgba(0,0,0,0.15); }
    .app-icon i { font-size: 40px; margin-bottom: 12px; }
    .app-name { font-weight: 600; font-size: 14px; color: #333; }
    
    /* Icon Colors */
    .icon-sub { color: #8b5cf6; background: linear-gradient(135deg, #f5f3ff, #ede9fe); }
    .icon-clock { color: #06b6d4; background: linear-gradient(135deg, #ecfeff, #cffafe); }
    .icon-weather { color: #f59e0b; background: linear-gradient(135deg, #fffbeb, #fef3c7); }
    .icon-music { color: #f43f5e; background: linear-gradient(135deg, #fff1f2, #ffe4e6); } 
    .icon-notes { color: #10b981; background: linear-gradient(135deg, #ecfdf5, #d1fae5); } 
    .icon-game { color: #6366f1; background: linear-gradient(135deg, #eef2ff, #e0e7ff); }  
    
    /* Dark Mode Overrides for Dashboard */
    body.dark-mode .app-icon { background: #1e293b; border-color: #334155; }
    body.dark-mode .app-name { color: #e2e8f0; }
    body.dark-mode .icon-sub { background: #2e1065; color: #a78bfa; }
    body.dark-mode .icon-clock { background: #083344; color: #22d3ee; }
    body.dark-mode .icon-weather { background: #451a03; color: #fbbf24; }
    body.dark-mode .icon-music { background: #4c0519; color: #fb7185; }
    body.dark-mode .icon-notes { background: #064e3b; color: #34d399; }
    body.dark-mode .icon-game { background: #312e81; color: #818cf8; }

    /* App View & Navigation */
    .app-view { display: none; animation: slideUp 0.3s ease-out; }
    .back-bar { padding: 10px 0 20px; }
    
    .back-btn {
        background: transparent; border: none; 
        font-size: 16px; font-weight: 700; 
        color: #8b5cf6; cursor: pointer;
        display: flex; align-items: center; gap: 8px;
        transition: all 0.2s ease;
    }
    body.dark-mode .back-btn { color: #a78bfa; }
    .back-btn:hover { color: #6d28d9; transform: translateX(-5px); }
    body.dark-mode .back-btn:hover { color: #c4b5fd; }

    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

    /* Global Variables */
    :root { --ink: #0f172a; --muted:#64748b; --card:#ffffff; --border:#e5e7eb; }
    body.dark-mode { --ink: #eef2ff; --muted: #94a3b8; --card: #1e293b; --border: #334155; }

    /* Subscription Manager Styles */
    #sm {
      box-sizing: border-box; font-family: 'Poppins', sans-serif;
      width: 100%; padding: 24px 16px 56px;
      background: rgba(255, 255, 255, 0.95); border-radius: 16px;
      transition: background 0.3s, color 0.3s; position: relative; 
    }
    body.dark-mode #sm { background: rgba(30, 30, 40, 0.95); }
    
    #sm h1 { margin: 0 0 12px; font-size: 26px; font-weight:700; color: var(--ink); }
    #sm p.sm-sub { margin:0; color: var(--muted); font-size:12px; }
    #sm .sm-top { display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap; margin:14px 0 18px; }
    #sm .sm-group { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    #sm .sm-input, #sm .sm-select { background: var(--card); color: var(--ink); border:1px solid var(--border); border-radius:12px; padding:10px 12px; font-size:14px; outline:none; min-height:40px; width: 100%; }
    #sm .sm-card { background: var(--card); border:1px solid var(--border); border-radius:16px; padding:16px; margin-bottom: 20px; box-shadow:0 8px 18px rgba(0,0,0,0.06); }
    #sm .sm-row { display:grid; grid-template-columns: repeat(12, 1fr); gap:10px; margin-top: 10px; }
    #sm .col-12 { grid-column: span 12; }
    #sm .col-6 { grid-column: span 6; }
    #sm .col-3 { grid-column: span 3; }
    #sm .sm-btn { border:1px solid var(--border); background: var(--card); color: var(--ink); border-radius:12px; padding:10px 14px; font-weight:600; cursor:pointer; }
    #sm .sm-btn.primary { background: linear-gradient(90deg, #ec4899, #06b6d4); color:#fff; border:0; }
    #sm .fx-grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap:10px; margin-bottom: 10px; }
    .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.6); z-index: 10000; display: none; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
    .modal-box { background: var(--card); padding: 30px; border-radius: 20px; width: 90%; max-width: 500px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); border: 1px solid var(--border); animation: popUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
    @media (max-width: 800px) { #sm .col-6, #sm .col-3 { grid-column: span 12; } }

    /* Clock & Pomodoro Styles */
    .clock-container {
        text-align: center; background: rgba(255,255,255,0.95);
        padding: 40px; border-radius: 30px; 
        box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        max-width: 500px; margin: 0 auto;
    }
    body.dark-mode .clock-container { background: #1e293b; }

    .digital-time { font-size: 70px; font-weight: 800; margin: 0; line-height: 1; color: var(--ink); letter-spacing: -2px; }
    .date-display { font-size: 16px; color: var(--muted); margin-bottom: 30px; font-weight: 500; text-transform: uppercase; letter-spacing: 2px; }

    .pomo-box {
        background: #fff0f3; border-radius: 30px; padding: 30px; 
        margin: 20px 0; transition: all 0.4s ease; box-shadow: 0 8px 20px rgba(0,0,0,0.05);
    }
    body.dark-mode .pomo-box { background: #2d1b20; } 
    
    .pomo-timer { 
        font-size: 80px; font-weight: 800; font-family: 'Poppins', sans-serif; 
        color: #ff4d6d; line-height: 1; margin: 20px 0; text-shadow: 2px 2px 0px rgba(0,0,0,0.05);
    }
    
    .mode-buttons { background: rgba(255,255,255,0.5); display: inline-flex; padding: 5px; border-radius: 50px; margin-bottom: 10px; }
    body.dark-mode .mode-buttons { background: rgba(0,0,0,0.2); }

    .mode-btn {
        background: transparent; border: none; padding: 8px 16px; border-radius: 20px; cursor: pointer;
        font-size: 13px; color: var(--muted); font-weight: 600; transition: all 0.3s;
    }
    .mode-btn:hover { background: rgba(0,0,0,0.05); }
    .mode-btn.active { background: #fff; color: #ff4d6d; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    body.dark-mode .mode-btn.active { background: #4a2c33; color: #ff8fa3; }
    
    .control-btn {
        padding: 15px 40px; font-size: 18px; border-radius: 50px;
        border: none; cursor: pointer; font-weight: 700;
        transition: transform 0.2s, box-shadow 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; margin: 0 auto;
    }
    .control-btn:hover { transform: scale(1.05); } .control-btn:active { transform: scale(0.95); }
    .btn-start { background: #ff4d6d; color: white; box-shadow: 0 10px 20px rgba(255, 77, 109, 0.3); }
    .btn-reset { width: 40px; height: 40px; padding: 0; border-radius: 50%; background: transparent; color: var(--muted); margin-left: 10px; font-size: 16px; }
    .btn-reset:hover { background: rgba(0,0,0,0.05); color: var(--ink); }

    .stopwatch-display { font-size: 40px; font-family: monospace; color: #009688; margin: 10px 0; font-weight: 700; }
    .sw-btn { padding: 8px 16px; margin: 0 5px; cursor: pointer; border-radius: 12px; border: none; font-weight: bold; font-size: 13px; text-transform: uppercase; transition: all 0.2s ease; }
    .sw-btn:hover { transform: translateY(-3px); filter: brightness(0.95); }
    .sw-btn:active { transform: translateY(0); }
    .btn-sw-stop { background: #fecaca; color: #ef4444; }
    .btn-sw-start { background: #bbf7d0; color: #16a34a; }
    .btn-sw-reset { background: #e5e7eb; color: #374151; }

    /* ===== WEATHER APP STYLES (WIDESCREEN + AUTOCOMPLETE + LIST FIX) ===== */
    .weather-container {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 30px; padding: 30px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        max-width: 1000px; margin: 0 auto;
        overflow: visible; position: relative;
    }
    body.dark-mode .weather-container { background: #1e293b; color: white; }

    .search-wrapper { position: relative; max-width: 500px; margin: 0 auto 30px; }
    
    .search-box { display: flex; gap: 10px; }
    .weather-input {
        flex: 1; padding: 12px 20px; border-radius: 50px;
        border: 1px solid var(--border); background: var(--card); color: var(--ink);
        font-size: 16px; outline: none;
    }
    .weather-btn {
        padding: 12px 20px; border-radius: 50px; border: none;
        background: #f59e0b; color: white; font-weight: bold; cursor: pointer;
        transition: transform 0.2s;
    }
    .weather-btn:hover { transform: scale(1.05); }

    /* SUGGESTIONS */
    .suggestions-list {
        position: absolute; top: 100%; left: 0; right: 0;
        background: var(--card); border: 1px solid var(--border);
        border-radius: 12px; margin-top: 5px;
        max-height: 200px; overflow-y: auto;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        z-index: 100; display: none;
    }
    .suggestion-item {
        padding: 10px 15px; cursor: pointer; text-align: left;
        font-size: 14px; border-bottom: 1px solid rgba(0,0,0,0.05); color: var(--ink);
    }
    .suggestion-item:hover { background: rgba(0,0,0,0.03); }
    body.dark-mode .suggestion-item:hover { background: rgba(255,255,255,0.05); }

    /* GRID LAYOUT */
    .weather-content-grid {
        display: grid; grid-template-columns: 1fr 1.5fr; gap: 40px; align-items: start;
        margin-top: 20px; animation: fadeIn 0.5s; display: none; 
    }
    @media (max-width: 768px) { .weather-content-grid { grid-template-columns: 1fr; } }

    .current-weather-card {
        text-align: center; padding: 30px; background: rgba(245, 158, 11, 0.05);
        border-radius: 24px; border: 1px solid rgba(245, 158, 11, 0.1);
    }
    .weather-icon { font-size: 100px; color: #f59e0b; margin-bottom: 15px; }
    .weather-temp { font-size: 70px; font-weight: 700; margin: 0; line-height: 1; }
    .weather-desc { font-size: 20px; color: var(--muted); text-transform: capitalize; margin-bottom: 20px; }

    .forecast-section { text-align: left; min-width: 0; }

    .rain-alert {
        background: #eff6ff; color: #1d4ed8; padding: 15px;
        border-radius: 12px; font-size: 14px; font-weight: 600;
        margin-bottom: 25px; border: 1px solid #dbeafe; display: none;
    }
    body.dark-mode .rain-alert { background: #172554; color: #93c5fd; border-color: #1e3a8a; }

    .hourly-scroll {
        display: flex; gap: 15px; overflow-x: auto; padding-bottom: 15px; margin-bottom: 25px; scroll-behavior: smooth;
    }
    .hourly-scroll::-webkit-scrollbar { height: 6px; }
    .hourly-scroll::-webkit-scrollbar-thumb { background: #e5e7eb; border-radius: 10px; }
    
    .hourly-card {
        min-width: 70px; background: rgba(0,0,0,0.03); padding: 10px;
        border-radius: 16px; display: flex; flex-direction: column; align-items: center;
        font-size: 13px; color: var(--ink);
    }
    body.dark-mode .hourly-card { background: rgba(255,255,255,0.05); }

    .daily-list { display: flex; flex-direction: column; gap: 10px; }
    .daily-row {
        display: flex; justify-content: space-between; align-items: center;
        padding: 12px 15px; background: rgba(0,0,0,0.03); border-radius: 16px;
        font-size: 14px; color: var(--ink); font-weight: 500;
    }
    body.dark-mode .daily-row { background: rgba(255,255,255,0.05); }

    .save-city-btn {
        background: #f59e0b; border: none; color: white;
        padding: 10px 25px; border-radius: 50px; margin-top: 10px; cursor: pointer;
        font-weight: 700; font-size: 14px; transition: all 0.2s; box-shadow: 0 5px 15px rgba(245, 158, 11, 0.3);
    }
    .save-city-btn:hover { transform: scale(1.05); }

    /* NEW SAVED CITIES LIST STYLES */
    .saved-cities-list {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 15px;
        margin-top: 25px;
    }
    
    .saved-city-card {
        background: var(--card);
        border: 1px solid var(--border);
        padding: 15px 20px;
        border-radius: 16px;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .saved-city-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        border-color: #f59e0b;
    }
    
    .saved-city-name { font-weight: 600; font-size: 14px; color: var(--ink); }
    
    /* Temp placeholder style */
    .saved-city-temp { 
        font-weight: 700; font-size: 18px; color: #f59e0b; 
        background: rgba(245, 158, 11, 0.1); padding: 2px 8px; border-radius: 8px;
    }
    
    .delete-saved-btn {
        background: transparent; border: none;
        color: #9ca3af; margin-left: 10px; cursor: pointer; padding: 5px;
        transition: color 0.2s;
    }
    .delete-saved-btn:hover { color: #ef4444; }

  </style>
</head>
<body>

  <div class="header-container">
     <a href="index.html">
        <img src="images/Coursework/Black_logo.PNG" class="logo" alt="Logo">
     </a>
     <div class="navbar">
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="Hobbies.html">Hobbies</a></li>
        <li><a href="Video.html">Video</a></li>
        <li><a href="app.html" class="active">Apps</a></li> 
        <li><a href="Clock.html">Clock</a></li>
      </ul>
     </div>
  </div>

  <div class="app-container">
      
      <div id="dashboardView">
          <h1 style="text-align:center; margin-bottom:10px;">My Apps</h1>
          <p style="text-align:center; color:var(--muted); margin-bottom:30px;">Select an app to launch</p>
          
          <div class="app-grid">
              <div class="app-icon icon-sub" onclick="openApp('subManager')">
                  <i class="fa-solid fa-receipt"></i>
                  <div class="app-name">Subscriptions</div>
              </div>
              <div class="app-icon icon-clock" onclick="openApp('clockApp')">
                  <i class="fa-solid fa-clock"></i>
                  <div class="app-name">Focus & Clock</div>
              </div>
              <div class="app-icon icon-weather" onclick="openApp('weatherApp')">
                  <i class="fa-solid fa-cloud-sun"></i>
                  <div class="app-name">Weather</div>
              </div>

              <div class="app-icon icon-music" onclick="alert('Music Player coming soon!')">
                  <i class="fa-solid fa-music"></i>
                  <div class="app-name">Music</div>
              </div>
              <div class="app-icon icon-notes" onclick="alert('Notes App coming soon!')">
                  <i class="fa-solid fa-note-sticky"></i>
                  <div class="app-name">Notes</div>
              </div>
              <div class="app-icon icon-game" onclick="alert('Snake Game coming soon!')">
                  <i class="fa-solid fa-gamepad"></i>
                  <div class="app-name">Game</div>
              </div>
          </div>
      </div>

      <div id="subManager" class="app-view">
          <div class="back-bar">
              <button class="back-btn" onclick="closeApp()"><i class="fa-solid fa-chevron-left"></i> Back to Apps</button>
          </div>
          <div id="sm">
              <div class="sm-top">
                <div style="text-align: left;">
                  <h1>Subscription Manager</h1>
                  <p class="sm-sub">Track your recurring payments easily.</p>
                </div>
                <div class="sm-group">
                  <label class="sm-label" style="font-size: 12px; color: var(--muted)">Sort:</label>
                  <select id="sortOrder" class="sm-select" style="width:auto; margin-right: 15px;">
                     <option value="date">Next Bill Date</option>
                     <option value="priceDesc">Price (High to Low)</option>
                     <option value="priceAsc">Price (Low to High)</option>
                     <option value="name">Name (A-Z)</option>
                  </select>
                  <label class="sm-label" style="font-size: 12px; color: var(--muted)">Currency:</label>
                  <select id="displayCcy" class="sm-select" style="width:auto;"></select>
                </div>
              </div>
              
              <div class="sm-card" style="display:flex; gap:20px; justify-content: space-around; text-align: center;">
                <div>
                    <div style="font-size:12px; color:var(--muted);">Monthly Total</div>
                    <div id="totMonthly" style="font-size:24px; font-weight:700; color:var(--ink);">$0.00</div>
                </div>
                <div>
                    <div style="font-size:12px; color:var(--muted);">Yearly Total</div>
                    <div id="totYearly" style="font-size:24px; font-weight:700; color:var(--ink);">$0.00</div>
                </div>
              </div>

              <section id="upcomingSection" class="sm-card" style="display:none; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border:none;">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <div style="text-align: left;">
                        <div style="font-size:12px; opacity:0.9; text-transform:uppercase; letter-spacing:1px; margin-bottom:5px;">Upcoming Payment</div>
                        <h2 id="upName" style="margin:0; font-size:22px; color:white;">Netflix</h2>
                        <div id="upDate" style="font-size:13px; opacity:0.9; margin-top:4px;">Due on 12/01/2026</div>
                    </div>
                    <div style="text-align:right;">
                        <div id="upCost" style="font-size:26px; font-weight:700;">$13.00</div>
                        <div id="upCountdown" style="font-size:12px; background:rgba(255,255,255,0.25); padding:4px 10px; border-radius:20px; display:inline-block; margin-top:5px; font-weight:600;">In 5 days</div>
                    </div>
                </div>
              </section>

              <section class="sm-card">
                <h3 style="color:var(--ink)">Add Subscription</h3>
                <div class="sm-row">
                  <div class="col-6"><input id="name" class="sm-input" placeholder="Name (e.g. Netflix)" /></div>
                  <div class="col-3"><input id="cost" type="number" class="sm-input" placeholder="Price" /></div>
                  <div class="col-3"><select id="currency" class="sm-select"></select></div>
                  <div class="col-6"><select id="cycle" class="sm-select"><option value="monthly">Monthly (Same Date)</option><option value="days30">Every 30 Days</option><option value="yearly">Yearly</option></select></div>
                   <div class="col-6"><input id="startDate" type="date" class="sm-input" /></div>
                </div>
                <button id="addBtn" class="sm-btn primary" style="margin-top: 15px; width: 100%;">+ Add Subscription</button>
              </section>

              <section class="sm-card"><h3 style="color:var(--ink)">Active Subscriptions (<span id="countActive">0</span>)</h3><div id="activeList"></div></section>
              <section class="sm-card" id="inactiveSection" style="display:none; border: 1px dashed var(--border); background: rgba(128,128,128,0.02);"><h3 style="color:var(--muted)">Inactive Subscriptions (<span id="countInactive">0</span>)</h3><div id="inactiveList"></div></section>
              
              <section class="sm-card">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                    <h3 style="color:var(--ink); margin:0;">FX Rates</h3>
                    <div id="fxDateDisplay" style="font-size:12px; color:var(--muted); font-style:italic;"></div>
                </div>
                <div id="fxGrid" class="fx-grid"></div>
                <button id="fxUpdate" class="sm-btn">Update Rates</button>
              </section>

              <div id="editModal" class="modal-overlay">
                <div class="modal-box">
                    <h2 style="color:var(--ink); margin-top:0;">Edit Subscription</h2>
                    <div class="sm-row">
                        <div class="col-12"><label style="font-size:12px; color:var(--muted);">Name</label><input id="editName" class="sm-input" /></div>
                        <div class="col-6"><label style="font-size:12px; color:var(--muted);">Price</label><input id="editCost" type="number" class="sm-input" /></div>
                        <div class="col-6"><label style="font-size:12px; color:var(--muted);">Currency</label><select id="editCurrency" class="sm-select"></select></div>
                        <div class="col-6"><label style="font-size:12px; color:var(--muted);">Cycle</label><select id="editCycle" class="sm-select"><option value="monthly">Monthly</option><option value="yearly">Yearly</option><option value="days30">Every 30 Days</option></select></div>
                        <div class="col-6"><label style="font-size:12px; color:var(--muted);">Start Date</label><input id="editDate" type="date" class="sm-input" /></div>
                    </div>
                    <div style="margin-top:25px; display:flex; gap:10px; justify-content:flex-end;">
                        <button onclick="window.closeEditModal()" class="sm-btn" style="background:transparent;">Cancel</button>
                        <button onclick="window.saveEdit()" class="sm-btn primary" style="background:#4ade80;">Save Changes</button>
                    </div>
                </div>
              </div>
          </div>
      </div>

      <div id="clockApp" class="app-view">
           <div class="back-bar">
              <button class="back-btn" onclick="closeApp()"><i class="fa-solid fa-chevron-left"></i> Back to Apps</button>
          </div>
          <div class="clock-container">
              
              <div class="digital-time" id="digitalTime">--:--</div>
              <div class="date-display" id="dateDisplay">--/--/----</div>

              <div class="pomo-box" id="pomoBox">
                  <div class="mode-buttons">
                      <button class="mode-btn active" onclick="switchPomoMode('focus')">üçÖ Focus</button>
                      <button class="mode-btn" onclick="switchPomoMode('short')">‚òï Break</button>
                      <button class="mode-btn" onclick="switchPomoMode('long')">üõãÔ∏è Long</button>
                  </div>
                  
                  <div class="pomo-timer" id="pomoTimer">25:00</div>
                  
                  <div style="display:flex; justify-content:center; align-items:center;">
                      <button class="control-btn btn-start" id="pomoStartBtn" onclick="togglePomo()">
                          <i class="fa-solid fa-play"></i> Start
                      </button>
                      <button class="control-btn btn-reset" onclick="resetPomo()">
                          <i class="fa-solid fa-rotate-right"></i>
                      </button>
                  </div>
              </div>

              <hr style="margin: 30px 0; border:0; border-top:1px solid #eee;">
              
              <h4 style="color:#009688; margin:0; text-transform: uppercase; letter-spacing: 1px;">Stopwatch</h4>
              <div class="stopwatch-display" id="swDisplay">00:00:00</div>
              <div>
                  <button class="sw-btn btn-sw-stop" onclick="Stop()">Stop</button>
                  <button class="sw-btn btn-sw-start" onclick="Start()">Start</button>
                  <button class="sw-btn btn-sw-reset" onclick="Reset()">Reset</button>
              </div>
          </div>
      </div>

      <div id="weatherApp" class="app-view">
           <div class="back-bar">
              <button class="back-btn" onclick="closeApp()"><i class="fa-solid fa-chevron-left"></i> Back to Apps</button>
          </div>
          
          <div class="weather-container">
              <h2 style="color:var(--ink); margin-bottom:10px;">Weather Search</h2>
              
              <div class="search-wrapper">
                  <div class="search-box">
                      <input type="text" id="cityInput" class="weather-input" placeholder="Enter city name (e.g. London)" onkeyup="handleInput(event)">
                      <button class="weather-btn" onclick="getWeather()"><i class="fa-solid fa-search"></i></button>
                  </div>
                  <div id="suggestionsList" class="suggestions-list"></div>
              </div>

              <div id="weatherResult" class="weather-content-grid">
                  
                  <div class="current-weather-card">
                      <div id="wIcon" class="weather-icon"><i class="fa-solid fa-cloud"></i></div>
                      <h3 id="wCity" style="margin:0; color:var(--ink); font-size:24px;">London</h3>
                      <div id="wTemp" class="weather-temp">15¬∞</div>
                      <div id="wDesc" class="weather-desc">Cloudy</div>
                      <button class="save-city-btn" onclick="saveCurrentCity()">‚ù§Ô∏è Save City</button>
                  </div>

                  <div class="forecast-section">
                      
                      <div id="rainAlert" class="rain-alert"><i class="fa-solid fa-umbrella"></i> Rain likely stopping at 14:00</div>

                      <h4 style="text-align:left; font-size:12px; color:var(--muted); text-transform:uppercase;">Next 24 Hours</h4>
                      <div id="hourlyScroll" class="hourly-scroll">
                          </div>

                      <h4 style="text-align:left; font-size:12px; color:var(--muted); text-transform:uppercase;">3-Day Forecast</h4>
                      <div id="dailyList" class="daily-list">
                          </div>
                  </div>
              </div>

              <div style="margin-top:40px; text-align:center;">
                  <h4 style="color:var(--muted); font-size:12px; text-transform:uppercase; letter-spacing:1px; margin-bottom:15px;">Saved Cities</h4>
                  
                  <div id="savedCitiesList" class="saved-cities-list">
                      </div>
              </div>
          </div>
      </div>

  </div>

  <script src="Coursework.js"></script>

  <script>
    window.openApp = function(appId) {
        document.getElementById('dashboardView').style.display = 'none';
        const app = document.getElementById(appId);
        if(app) { app.style.display = 'block'; window.scrollTo(0, 0); }
    };
    window.closeApp = function() {
        document.querySelectorAll('.app-view').forEach(app => app.style.display = 'none');
        document.getElementById('dashboardView').style.display = 'block';
    };
  </script>

  <script>
    function updateClock() {
        const now = new Date();
        document.getElementById('digitalTime').textContent = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', second:'2-digit'});
        const day = String(now.getDate()).padStart(2, '0');
        const mo = String(now.getMonth()+1).padStart(2,'0');
        const yr = now.getFullYear();
        document.getElementById('dateDisplay').textContent = `${day}/${mo}/${yr}`;
    }
    setInterval(updateClock, 1000); updateClock();

    let swTimer = null; let swSec = 0, swMin = 0, swHour = 0;
    window.Start = function() { if(!swTimer) swTimer = setInterval(swUpdate, 1000); };
    window.Stop = function() { clearInterval(swTimer); swTimer = null; };
    window.Reset = function() { Stop(); swSec=0; swMin=0; swHour=0; document.getElementById('swDisplay').textContent = "00:00:00"; };
    function swUpdate() {
        swSec++; if(swSec==60){swSec=0;swMin++} if(swMin==60){swMin=0;swHour++}
        const h = swHour<10?"0"+swHour:swHour; const m = swMin<10?"0"+swMin:swMin; const s = swSec<10?"0"+swSec:swSec;
        document.getElementById('swDisplay').textContent = `${h}:${m}:${s}`;
    }

    let pomoTime = 25 * 60; let pomoInterval = null; let isRunning = false; let currentMode = 'focus';
    window.switchPomoMode = function(mode) {
        window.resetPomo(); currentMode = mode;
        document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
        const btns = document.querySelectorAll('.mode-btn');
        if(mode === 'focus') { btns[0].classList.add('active'); pomoTime = 25*60; }
        if(mode === 'short') { btns[1].classList.add('active'); pomoTime = 5*60; }
        if(mode === 'long')  { btns[2].classList.add('active'); pomoTime = 15*60; }
        
        const box = document.getElementById('pomoBox'); const btn = document.getElementById('pomoStartBtn'); const timerTxt = document.getElementById('pomoTimer');
        if(mode === 'focus') {
            box.style.background = document.body.classList.contains('dark-mode') ? "#2d1b20" : "#fff0f3"; 
            timerTxt.style.color = "#ff4d6d";
            btn.style.background = "#ff4d6d"; btn.style.boxShadow = "0 10px 20px rgba(255, 77, 109, 0.3)";
            btn.innerHTML = `<i class="fa-solid fa-play"></i> Start Focus`;
        } else {
            box.style.background = document.body.classList.contains('dark-mode') ? "#14281d" : "#f0fdf4"; 
            timerTxt.style.color = "#4ade80";
            btn.style.background = "#4ade80"; btn.style.boxShadow = "0 10px 20px rgba(74, 222, 128, 0.3)";
            btn.innerHTML = `<i class="fa-solid fa-mug-hot"></i> Start Break`;
        }
        updatePomoDisplay();
    };
    window.togglePomo = function() {
        const btn = document.getElementById('pomoStartBtn');
        if(isRunning) { clearInterval(pomoInterval); isRunning = false; btn.innerHTML = `<i class="fa-solid fa-play"></i> Resume`; btn.style.opacity = "1"; } 
        else {
            pomoInterval = setInterval(() => {
                pomoTime--; updatePomoDisplay();
                if(pomoTime <= 0) { clearInterval(pomoInterval); isRunning = false; const audio = new Audio('https://actions.google.com/sounds/v1/alarms/beep_short.ogg'); audio.play(); alert("Time is up!"); window.switchPomoMode(currentMode); }
            }, 1000);
            isRunning = true; btn.innerHTML = `<i class="fa-solid fa-pause"></i> Pause`; btn.style.opacity = "0.9";
        }
    };
    window.resetPomo = function() {
        clearInterval(pomoInterval); isRunning = false;
        if(currentMode === 'focus') pomoTime = 25*60; else if(currentMode === 'short') pomoTime = 5*60; else pomoTime = 15*60;
        const btn = document.getElementById('pomoStartBtn');
        btn.innerHTML = currentMode === 'focus' ? `<i class="fa-solid fa-play"></i> Start Focus` : `<i class="fa-solid fa-mug-hot"></i> Start Break`;
        updatePomoDisplay();
    };
    function updatePomoDisplay() { const m = Math.floor(pomoTime / 60); const s = pomoTime % 60; document.getElementById('pomoTimer').textContent = `${m < 10 ? '0'+m : m}:${s < 10 ? '0'+s : s}`; }
  </script>

  <script>
  (function(){
    const $ = (id) => document.getElementById(id);
    const K_SUBS = 'sm:subs:v2'; const K_CURRENCY = 'sm:display_currency'; const K_SORT = 'sm:sort_order';
    let DEFAULT_FX = { USD:1, GBP:0.77, EUR:0.92, HKD:7.8, JPY:157, CAD:1.36, AUD:1.52, CNY:7.23 };
    let subs = []; try { subs = JSON.parse(localStorage.getItem(K_SUBS) || '[]'); } catch(e) { subs = []; }
    let display = localStorage.getItem(K_CURRENCY) || 'USD'; let currentSort = localStorage.getItem(K_SORT) || 'date'; let fx = DEFAULT_FX; let editIndex = -1;

    function save(){ localStorage.setItem(K_SUBS, JSON.stringify(subs)); }
    function fmtMoney(n, ccy){ return new Intl.NumberFormat('en-US', { style: 'currency', currency: ccy }).format(n); }
    function convert(amount, src, dest){ const s = fx[src] || 1; const d = fx[dest] || 1; return (amount / s) * d; }
    function getNextBillDate(startDate, cycle) {
        if (!startDate) return null; let due = new Date(startDate); const today = new Date(); today.setHours(0,0,0,0); 
        if (due >= today) return due.toLocaleDateString();
        while (due < today) { if (cycle === 'monthly') due.setMonth(due.getMonth() + 1); else if (cycle === 'days30') due.setDate(due.getDate() + 30); else due.setFullYear(due.getFullYear() + 1); }
        return due.toLocaleDateString();
    }
    function getNextBillTimestamp(startDate, cycle) {
        if (!startDate) return 9999999999999; let due = new Date(startDate); const today = new Date(); today.setHours(0,0,0,0); 
        if (due >= today) return due.getTime();
        while (due < today) { if (cycle === 'monthly') due.setMonth(due.getMonth() + 1); else if (cycle === 'days30') due.setDate(due.getDate() + 30); else due.setFullYear(due.getFullYear() + 1); }
        return due.getTime();
    }
    async function fetchLiveRates() {
        const btn = $('fxUpdate'); if(!btn) return; 
        const originalText = btn.textContent; btn.textContent = "Fetching..."; btn.disabled = true;
        try { 
            const response = await fetch('https://api.frankfurter.app/latest?from=USD'); 
            if (!response.ok) throw new Error("Failed"); const data = await response.json(); 
            fx = { USD: 1, ...data.rates }; 
            if(data.date) document.getElementById('fxDateDisplay').innerText = "Rates as of: " + data.date;
            render(); btn.textContent = "Rates Updated!"; 
        } 
        catch (error) { fx = DEFAULT_FX; render(); btn.textContent = "Update Failed"; } 
        finally { setTimeout(() => { btn.textContent = originalText; btn.disabled = false; }, 2000); }
    }

    function render(){
        if(!$('activeList')) return;
        let nearestSub = null; let minTime = 9999999999000;
        subs.forEach(s => { if(s.active && s.date) { let ts = getNextBillTimestamp(s.date, s.cycle); if(ts < minTime) { minTime = ts; nearestSub = s; } } });
        const upSec = $('upcomingSection');
        if(nearestSub) {
            upSec.style.display = 'block'; $('upName').textContent = nearestSub.name; $('upCost').textContent = fmtMoney(nearestSub.cost, nearestSub.currency);
            let dateObj = new Date(minTime); $('upDate').textContent = "Due on " + dateObj.toLocaleDateString();
            let now = new Date(); now.setHours(0,0,0,0); let diffTime = dateObj - now; let diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            let dayText = diffDays === 0 ? "Today!" : (diffDays === 1 ? "Tomorrow" : `In ${diffDays} days`);
            $('upCountdown').textContent = dayText;
        } else { upSec.style.display = 'none'; }

        subs.sort((a, b) => {
            if (currentSort === 'name') return a.name.localeCompare(b.name);
            else if (currentSort === 'priceDesc') return convert(b.cost, b.currency, 'USD') - convert(a.cost, a.currency, 'USD');
            else if (currentSort === 'priceAsc') return convert(a.cost, a.currency, 'USD') - convert(b.cost, b.currency, 'USD');
            else return getNextBillTimestamp(a.date, a.cycle) - getNextBillTimestamp(b.date, b.cycle);
        });

        const activeList = $('activeList'); const inactiveList = $('inactiveList'); activeList.innerHTML = ''; inactiveList.innerHTML = '';
        let mTotal = 0; let yTotal = 0; let actCount = 0; let inactCount = 0;

        subs.forEach((s, index) => {
            if (typeof s.active === 'undefined') s.active = true;
            const val = convert(s.cost, s.currency, display);
            if (s.active) { actCount++; if(s.cycle === 'monthly') { mTotal += val; yTotal += val * 12; } else if(s.cycle === 'days30') { let occ = 365/30; mTotal += (val*occ)/12; yTotal += val*occ; } else { mTotal += val / 12; yTotal += val; } } else { inactCount++; }
            const nextDate = getNextBillDate(s.date, s.cycle);
            const dateHTML = nextDate ? `<div style="font-size:11px; color:#eab308; display:flex; align-items:center; gap:4px;">Next Bill: ${nextDate}</div>` : '';
            let cycleText = s.active ? (s.cycle === 'monthly' ? 'monthly' : (s.cycle === 'days30' ? '30 DAYS' : 'yearly')) : 'PAUSED';
            const div = document.createElement('div'); const bg = s.active ? "transparent" : "rgba(128, 128, 128, 0.05)";
            div.style.cssText = `display:flex; justify-content:space-between; padding: 12px; border-bottom:1px solid var(--border); color: var(--ink); align-items: center; background:${bg};`;
            div.innerHTML = `<div style="display:flex; flex-direction:column; align-items:flex-start; gap:2px;"><div style="display:flex; align-items:center; gap:6px; flex-wrap:wrap;"><strong style="font-size:16px;">${s.name}</strong><span style="font-size:11px; background:${s.active ? '#e0f2fe' : '#ddd'}; color:${s.active ? '#0284c7' : '#666'}; padding:2px 6px; border-radius:4px; font-weight:600;">${cycleText}</span></div>${s.active ? dateHTML : ''}</div><div style="text-align:right; display:flex; flex-direction:column; align-items:flex-end; gap:5px;"><div style="font-weight:bold; font-size:16px;">${fmtMoney(s.cost, s.currency)}</div><div style="display:flex; gap:8px;"><button onclick="window.toggleSub(${index})" style="font-size:12px; border:1px solid var(--border); background:var(--card); color:var(--ink); padding:5px 10px; border-radius:6px; cursor:pointer; min-width: 65px;">${s.active ? 'Pause' : 'Resume'}</button><button onclick="window.openEditModal(${index})" style="font-size:12px; border:1px solid var(--border); background:var(--card); color:var(--ink); padding:5px 10px; border-radius:6px; cursor:pointer;">Edit</button><button onclick="window.delSub(${index})" style="font-size:12px; border:1px solid #fee2e2; background:#fef2f2; color:#ef4444; padding:5px 10px; border-radius:6px; cursor:pointer;">Delete</button></div></div>`;
            if (s.active) activeList.appendChild(div); else inactiveList.appendChild(div);
        });
        $('totMonthly').innerText = fmtMoney(mTotal, display); $('totYearly').innerText = fmtMoney(yTotal, display); $('countActive').innerText = actCount; $('countInactive').innerText = inactCount; $('inactiveSection').style.display = (inactCount === 0) ? 'none' : 'block';
        const opts = Object.keys(fx).sort().map(c => `<option value="${c}">${c}</option>`).join(''); $('currency').innerHTML = opts; $('displayCcy').innerHTML = opts; $('editCurrency').innerHTML = opts; $('displayCcy').value = display; $('sortOrder').value = currentSort;
        const grid = $('fxGrid'); grid.innerHTML = ''; Object.keys(fx).forEach(ccy => { if(ccy === 'USD') return; const item = document.createElement('div'); item.className = 'fx-item'; item.innerHTML = `<div style="font-weight:bold; color:var(--ink);">${ccy}</div><div style="color:var(--muted); font-size:13px;">${fx[ccy].toFixed(2)}</div>`; grid.appendChild(item); });
    }
    const addBtn = $('addBtn'); if(addBtn) addBtn.addEventListener('click', () => { const name = $('name').value; const cost = parseFloat($('cost').value); if(!name || isNaN(cost)) return alert('Name and Price are required'); subs.push({ name, cost, currency: $('currency').value, cycle: $('cycle').value, date: $('startDate').value, active: true }); save(); render(); $('name').value = ''; $('cost').value = ''; $('startDate').value = ''; });
    const dispCcy = $('displayCcy'); if(dispCcy) dispCcy.addEventListener('change', (e) => { display = e.target.value; localStorage.setItem(K_CURRENCY, display); render(); });
    const sortOrd = $('sortOrder'); if(sortOrd) sortOrd.addEventListener('change', (e) => { currentSort = e.target.value; localStorage.setItem(K_SORT, currentSort); render(); });
    const fxBtn = $('fxUpdate'); if(fxBtn) fxBtn.addEventListener('click', fetchLiveRates);
    window.delSub = function(index) { if(confirm('Delete?')) { subs.splice(index, 1); save(); render(); if(editIndex===index) window.closeEditModal(); }};
    window.toggleSub = function(index) { if (typeof subs[index].active === 'undefined') subs[index].active = true; subs[index].active = !subs[index].active; save(); render(); };
    window.openEditModal = function(index) { const s = subs[index]; $('editName').value = s.name; $('editCost').value = s.cost; $('editCurrency').value = s.currency; $('editCycle').value = s.cycle; $('editDate').value = s.date || ''; editIndex = index; $('editModal').style.display = 'flex'; };
    window.closeEditModal = function() { $('editModal').style.display = 'none'; editIndex = -1; };
    window.saveEdit = function() { if(editIndex === -1) return; const name = $('editName').value; const cost = parseFloat($('editCost').value); if(!name || isNaN(cost)) return alert('Name and Price are required'); subs[editIndex].name = name; subs[editIndex].cost = cost; subs[editIndex].currency = $('editCurrency').value; subs[editIndex].cycle = $('editCycle').value; subs[editIndex].date = $('editDate').value; save(); render(); window.closeEditModal(); };
    render(); fetchLiveRates(); 
  })();
  </script>

  <script>
    let savedCities = JSON.parse(localStorage.getItem('sm:savedCities') || '[]');
    let currentCityData = null;
    let debounceTimer;

    function getWeatherIcon(code) {
        if (code >= 0 && code <= 2) return 'fa-sun';
        if (code >= 3 && code <= 48) return 'fa-cloud';
        if (code >= 51 && code <= 67) return 'fa-cloud-rain';
        if (code >= 71 && code <= 77) return 'fa-snowflake';
        if (code >= 80 && code <= 82) return 'fa-cloud-showers-heavy';
        if (code >= 95) return 'fa-bolt';
        return 'fa-cloud';
    }

    // AUTOCOMPLETE HANDLER
    function handleInput(event) {
        if (event.key === 'Enter') {
            getWeather();
            document.getElementById('suggestionsList').style.display = 'none';
            return;
        }
        
        clearTimeout(debounceTimer);
        debounceTimer = setTimeout(() => {
            fetchSuggestions(event.target.value);
        }, 300);
    }

    async function fetchSuggestions(query) {
        const list = document.getElementById('suggestionsList');
        if (query.length < 2) {
            list.style.display = 'none';
            return;
        }

        try {
            const res = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${query}&count=10&language=en&format=json`);
            const data = await res.json();
            
            if (data.results) {
                list.innerHTML = '';
                list.style.display = 'block';
                
                // CLEANING LOGIC (Duplicates / HK / Macau)
                const seen = new Set();
                
                data.results.forEach(city => {
                    let displayName = `${city.name}`;
                    if (city.name === "Hong Kong" && (!city.country || city.country === "undefined" || city.country_code === "HK")) {
                        displayName = "Hong Kong, China";
                    } else if (city.name === "Macau" && (!city.country || city.country === "undefined" || city.country_code === "MO")) {
                        displayName = "Macau, China";
                    } else if (city.country) {
                        displayName = `${city.name}, ${city.country}`;
                    }

                    if (!seen.has(displayName)) {
                        seen.add(displayName);
                        const item = document.createElement('div');
                        item.className = 'suggestion-item';
                        item.textContent = displayName;
                        item.onclick = () => {
                            document.getElementById('cityInput').value = city.name;
                            list.style.display = 'none';
                            getWeatherByCoords(city.latitude, city.longitude, displayName.split(',')[0]); 
                        };
                        list.appendChild(item);
                    }
                });

            } else {
                list.style.display = 'none';
            }
        } catch (e) {
            console.error(e);
        }
    }

    document.addEventListener('click', function(e) {
        if (!e.target.closest('.search-wrapper')) {
            document.getElementById('suggestionsList').style.display = 'none';
        }
    });

    // Main Weather Function
    async function getWeather(cityName = null) {
        const input = document.getElementById('cityInput');
        const city = cityName || input.value;
        if(!city) return;

        try {
            const geoRes = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${city}&count=1&language=en&format=json`);
            const geoData = await geoRes.json();
            
            if(!geoData.results) { alert("City not found"); return; }
            
            const { latitude, longitude, name } = geoData.results[0];
            getWeatherByCoords(latitude, longitude, name);
            input.value = ''; 
        } catch(e) { console.error(e); alert("Could not fetch weather data."); }
    }

    async function getWeatherByCoords(lat, lon, name) {
        try {
            const weatherRes = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,weather_code,is_day&hourly=temperature_2m,weather_code,precipitation_probability&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=auto`);
            const wData = await weatherRes.json();
            
            displayFullWeather(name, wData);
            currentCityData = name; 
        } catch(e) { console.error(e); }
    }

    function displayFullWeather(city, data) {
        document.getElementById('weatherResult').style.display = 'grid'; 
        const current = data.current;
        if(city === "Hong Kong") city = "Hong Kong"; 
        
        document.getElementById('wCity').textContent = city;
        document.getElementById('wTemp').textContent = `${Math.round(current.temperature_2m)}¬∞C`;
        document.getElementById('wIcon').innerHTML = `<i class="fa-solid ${getWeatherIcon(current.weather_code)}"></i>`;
        document.getElementById('wDesc').textContent = getDesc(current.weather_code);

        // Rain Logic
        const hourProbs = data.hourly.precipitation_probability;
        const currentHourIndex = new Date().getHours();
        const currentProb = hourProbs[currentHourIndex];
        const alertBox = document.getElementById('rainAlert');
        
        if(currentProb > 40) {
            let stopIndex = -1;
            for(let i=currentHourIndex; i < currentHourIndex+12; i++) { if(hourProbs[i] < 20) { stopIndex = i; break; } }
            alertBox.style.display = 'block';
            alertBox.innerHTML = stopIndex !== -1 ? `<i class="fa-solid fa-umbrella"></i> Rain likely stopping around ${stopIndex}:00` : `<i class="fa-solid fa-cloud-showers-heavy"></i> Rain expected to continue for hours.`;
        } else {
            let startIndex = -1;
            for(let i=currentHourIndex; i < currentHourIndex+12; i++) { if(hourProbs[i] > 50) { startIndex = i; break; } }
            if(startIndex !== -1) {
                alertBox.style.display = 'block';
                alertBox.innerHTML = `<i class="fa-solid fa-cloud-rain"></i> Rain might start around ${startIndex}:00`;
            } else { alertBox.style.display = 'none'; }
        }

        // Hourly Scroll
        const hScroll = document.getElementById('hourlyScroll');
        hScroll.innerHTML = '';
        for(let i=currentHourIndex; i < currentHourIndex + 24; i++) {
            if(i >= data.hourly.temperature_2m.length) break;
            const temp = Math.round(data.hourly.temperature_2m[i]);
            const code = data.hourly.weather_code[i];
            const time = i % 24;
            const timeStr = `${time}:00`;
            hScroll.innerHTML += `<div class="hourly-card"><div style="margin-bottom:5px; font-weight:600;">${timeStr}</div><i class="fa-solid ${getWeatherIcon(code)}" style="font-size:20px; color:#f59e0b; margin-bottom:5px;"></i><div style="font-weight:700;">${temp}¬∞</div></div>`;
        }

        // Daily Forecast
        const dList = document.getElementById('dailyList');
        dList.innerHTML = '';
        const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
        for(let i=0; i<3; i++) {
            const date = new Date(data.daily.time[i]);
            const dayName = i===0 ? "Today" : days[date.getDay()];
            const min = Math.round(data.daily.temperature_2m_min[i]);
            const max = Math.round(data.daily.temperature_2m_max[i]);
            const code = data.daily.weather_code[i];
            dList.innerHTML += `<div class="daily-row"><div style="width:80px;">${dayName}</div><div style="flex:1; text-align:center;"><i class="fa-solid ${getWeatherIcon(code)}" style="color:#f59e0b;"></i></div><div>${max}¬∞ / ${min}¬∞</div></div>`;
        }
    }

    function getDesc(code) {
        if(code <= 2) return "Clear/Cloudy"; if(code <= 48) return "Foggy"; if(code <= 67) return "Rainy"; if(code <= 77) return "Snowy"; return "Stormy";
    }

    function saveCurrentCity() {
        if(!currentCityData) return;
        if(!savedCities.includes(currentCityData)) {
            savedCities.push(currentCityData);
            localStorage.setItem('sm:savedCities', JSON.stringify(savedCities));
            renderSavedCities();
        }
    }

    function deleteCity(city, event) {
        event.stopPropagation();
        savedCities = savedCities.filter(c => c !== city);
        localStorage.setItem('sm:savedCities', JSON.stringify(savedCities));
        renderSavedCities();
    }

    // --- NEW: RENDER SAVED CITIES AS CARDS WITH TEMP FETCH ---
    async function renderSavedCities() {
        const list = document.getElementById('savedCitiesList');
        list.innerHTML = '';
        
        // Loop through saved cities and create cards
        savedCities.forEach(city => {
            const div = document.createElement('div');
            div.className = 'saved-city-card';
            div.onclick = () => getWeather(city); // Click card to load full weather
            
            div.innerHTML = `
                <div>
                    <div class="saved-city-name">${city}</div>
                </div>
                <div style="display:flex; align-items:center;">
                    <span class="saved-city-temp" id="mini-temp-${city.replace(/\s/g, '')}">--¬∞</span>
                    <button class="delete-saved-btn" onclick="deleteCity('${city}', event)">
                        <i class="fa-solid fa-trash"></i>
                    </button>
                </div>
            `;
            list.appendChild(div);
            
            // Fetch individual temperature for this card
            fetchMiniTemp(city);
        });
    }

    async function fetchMiniTemp(city) {
        try {
            // 1. Geocode
            const geoRes = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${city}&count=1&language=en&format=json`);
            const geoData = await geoRes.json();
            if(!geoData.results) return;
            const { latitude, longitude } = geoData.results[0];

            // 2. Fetch JUST current temp
            const wRes = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current_weather=true`);
            const wData = await wRes.json();
            
            // 3. Update DOM
            const tempEl = document.getElementById(`mini-temp-${city.replace(/\s/g, '')}`);
            if(tempEl) {
                tempEl.textContent = `${Math.round(wData.current_weather.temperature)}¬∞`;
            }
        } catch(e) { console.error("Mini fetch error", e); }
    }

    renderSavedCities();
  </script>
</body>
</html>
