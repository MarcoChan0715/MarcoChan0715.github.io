<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Apps Dashboard</title>

  <link rel="icon" type="image/x-icon" href="images/Coursework/favicon.ico?v=2">

  <link rel="stylesheet" href="Coursework.css" />
  <script src="https://kit.fontawesome.com/f65489be61.js" crossorigin="anonymous"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    /* =========================================
       APP-SPECIFIC STYLES
       ========================================= */
    body { font-family: 'Poppins', sans-serif; }
    * { box-sizing: border-box; }

    /* Dashboard Layout */
    .app-container { max-width: 1100px; margin: 0 auto; padding-top: 160px; padding-bottom: 50px; }
    
    .app-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 30px;
        padding: 20px;
        justify-items: center;
        animation: fadeIn 0.5s ease;
    }

    .app-icon {
        width: 140px; height: 140px;
        background: white; border-radius: 28px;
        box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;
        border: 1px solid rgba(0,0,0,0.05); text-align: center; padding: 10px;
    }
    .app-icon:hover { transform: translateY(-5px); box-shadow: 0 15px 35px rgba(0,0,0,0.15); }
    .app-icon i { font-size: 40px; margin-bottom: 12px; }
    .app-name { font-weight: 600; font-size: 14px; color: #333; }
    
    /* Icon Colors */
    .icon-sub { color: #8b5cf6; background: linear-gradient(135deg, #f5f3ff, #ede9fe); }
    .icon-clock { color: #06b6d4; background: linear-gradient(135deg, #ecfeff, #cffafe); }
    .icon-weather { color: #f59e0b; background: linear-gradient(135deg, #fffbeb, #fef3c7); }
    /* New App Colors */
    .icon-music { color: #f43f5e; background: linear-gradient(135deg, #fff1f2, #ffe4e6); } 
    .icon-notes { color: #10b981; background: linear-gradient(135deg, #ecfdf5, #d1fae5); } 
    .icon-game { color: #6366f1; background: linear-gradient(135deg, #eef2ff, #e0e7ff); }  
    
    /* Dark Mode Overrides */
    body.dark-mode .app-icon { background: #1e293b; border-color: #334155; }
    body.dark-mode .app-name { color: #e2e8f0; }
    body.dark-mode .icon-sub { background: #2e1065; color: #a78bfa; }
    body.dark-mode .icon-clock { background: #083344; color: #22d3ee; }
    body.dark-mode .icon-weather { background: #451a03; color: #fbbf24; }
    body.dark-mode .icon-music { background: #4c0519; color: #fb7185; }
    body.dark-mode .icon-notes { background: #064e3b; color: #34d399; }
    body.dark-mode .icon-game { background: #312e81; color: #818cf8; }

    /* App View & Navigation */
    .app-view { display: none; animation: slideUp 0.3s ease-out; }
    .back-bar { padding: 10px 0 20px; }
    
    .back-btn {
        background: transparent; border: none; font-size: 16px; font-weight: 700; 
        color: #8b5cf6; cursor: pointer; display: flex; align-items: center; gap: 8px;
        transition: all 0.2s ease;
    }
    body.dark-mode .back-btn { color: #a78bfa; }
    .back-btn:hover { color: #6d28d9; transform: translateX(-5px); }
    body.dark-mode .back-btn:hover { color: #c4b5fd; }

    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

    /* Weather Styles */
    .weather-container {
        background: rgba(255, 255, 255, 0.95); border-radius: 30px; padding: 30px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.1); max-width: 1000px; margin: 0 auto;
        overflow: visible; position: relative;
    }
    body.dark-mode .weather-container { background: #1e293b; color: white; }

    .search-wrapper { position: relative; max-width: 500px; margin: 0 auto 30px; }
    .search-box { display: flex; gap: 10px; }
    .weather-input {
        flex: 1; padding: 12px 20px; border-radius: 50px;
        border: 1px solid #e5e7eb; background: #fff; color: #0f172a;
        font-size: 16px; outline: none;
    }
    body.dark-mode .weather-input { background: #1e293b; color: white; border-color: #334155; }
    .weather-btn {
        padding: 12px 20px; border-radius: 50px; border: none;
        background: #f59e0b; color: white; font-weight: bold; cursor: pointer; transition: transform 0.2s;
    }
    .weather-btn:hover { transform: scale(1.05); }

    .suggestions-list {
        position: absolute; top: 100%; left: 0; right: 0;
        background: #fff; border: 1px solid #e5e7eb; border-radius: 12px; margin-top: 5px;
        max-height: 200px; overflow-y: auto; box-shadow: 0 10px 30px rgba(0,0,0,0.1); z-index: 100; display: none;
    }
    body.dark-mode .suggestions-list { background: #1e293b; border-color: #334155; }
    .suggestion-item { padding: 10px 15px; cursor: pointer; text-align: left; font-size: 14px; border-bottom: 1px solid rgba(0,0,0,0.05); color: #333; }
    body.dark-mode .suggestion-item { color: #e2e8f0; }
    .suggestion-item:hover { background: rgba(0,0,0,0.03); }
    body.dark-mode .suggestion-item:hover { background: rgba(255,255,255,0.05); }

    .weather-content-grid { display: grid; grid-template-columns: 1fr 1.5fr; gap: 40px; align-items: start; margin-top: 20px; animation: fadeIn 0.5s; display: none; }
    @media (max-width: 768px) { .weather-content-grid { grid-template-columns: 1fr; } }

    .current-weather-card { text-align: center; padding: 30px; background: rgba(245, 158, 11, 0.05); border-radius: 24px; border: 1px solid rgba(245, 158, 11, 0.1); }
    .weather-icon { font-size: 100px; color: #f59e0b; margin-bottom: 15px; }
    .weather-temp { font-size: 70px; font-weight: 700; margin: 0; line-height: 1; }
    .weather-desc { font-size: 20px; color: #64748b; text-transform: capitalize; margin-bottom: 20px; }
    .forecast-section { text-align: left; min-width: 0; }
    .rain-alert { background: #eff6ff; color: #1d4ed8; padding: 15px; border-radius: 12px; font-size: 14px; font-weight: 600; margin-bottom: 25px; border: 1px solid #dbeafe; display: none; }
    body.dark-mode .rain-alert { background: #172554; color: #93c5fd; border-color: #1e3a8a; }
    .hourly-scroll { display: flex; gap: 15px; overflow-x: auto; padding-bottom: 15px; margin-bottom: 25px; scroll-behavior: smooth; }
    .hourly-card { min-width: 70px; background: rgba(0,0,0,0.03); padding: 10px; border-radius: 16px; display: flex; flex-direction: column; align-items: center; font-size: 13px; color: #0f172a; }
    body.dark-mode .hourly-card { background: rgba(255,255,255,0.05); color: white; }
    .daily-list { display: flex; flex-direction: column; gap: 10px; }
    .daily-row { display: flex; justify-content: space-between; align-items: center; padding: 12px 15px; background: rgba(0,0,0,0.03); border-radius: 16px; font-size: 14px; font-weight: 500; }
    body.dark-mode .daily-row { background: rgba(255,255,255,0.05); }
    .save-city-btn { background: #f59e0b; border: none; color: white; padding: 10px 25px; border-radius: 50px; margin-top: 10px; cursor: pointer; font-weight: 700; font-size: 14px; transition: all 0.2s; box-shadow: 0 5px 15px rgba(245, 158, 11, 0.3); }
    .save-city-btn:hover { transform: scale(1.05); }

    .saved-cities-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; margin-top: 25px; }
    .saved-city-card { background: #fff; border: 1px solid #e5e7eb; padding: 15px 20px; border-radius: 16px; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; display: flex; justify-content: space-between; align-items: center; }
    body.dark-mode .saved-city-card { background: #1e293b; border-color: #334155; }
    .saved-city-card:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.05); border-color: #f59e0b; }
    .saved-city-name { font-weight: 600; font-size: 14px; color: #0f172a; }
    body.dark-mode .saved-city-name { color: #e2e8f0; }
    .saved-city-temp { font-weight: 700; font-size: 18px; color: #f59e0b; background: rgba(245, 158, 11, 0.1); padding: 2px 8px; border-radius: 8px; }
    .delete-saved-btn { background: transparent; border: none; color: #9ca3af; margin-left: 10px; cursor: pointer; padding: 5px; transition: color 0.2s; }
    .delete-saved-btn:hover { color: #ef4444; }

    /* Other App Styles (Sub/Clock) kept simple for brevity as they are unchanged */
    #sm, .clock-container { max-width: 100%; } 
  </style>
</head>
<body>

  <div class="header-container">
     <a href="index.html">
        <img src="images/Coursework/Black_logo.PNG" class="logo" alt="Logo">
     </a>
     <div class="navbar">
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="Hobbies.html">Hobbies</a></li>
        <li><a href="Video.html">Video</a></li>
        <li><a href="app.html" class="active">Apps</a></li> 
        <li><a href="Clock.html">Clock</a></li>
      </ul>
     </div>
  </div>

  <div class="app-container">
      
      <div id="dashboardView">
          <h1 style="text-align:center; margin-bottom:10px;">My Apps</h1>
          <p style="text-align:center; color:#64748b; margin-bottom:30px;">Select an app to launch</p>
          
          <div class="app-grid">
              <div class="app-icon icon-sub" onclick="openApp('subManager')">
                  <i class="fa-solid fa-receipt"></i>
                  <div class="app-name">Subscriptions</div>
              </div>
              <div class="app-icon icon-clock" onclick="openApp('clockApp')">
                  <i class="fa-solid fa-clock"></i>
                  <div class="app-name">Focus & Clock</div>
              </div>
              <div class="app-icon icon-weather" onclick="openApp('weatherApp')">
                  <i class="fa-solid fa-cloud-sun"></i>
                  <div class="app-name">Weather</div>
              </div>

              <div class="app-icon icon-music" onclick="alert('Music Player coming soon!')">
                  <i class="fa-solid fa-music"></i>
                  <div class="app-name">Music</div>
              </div>
              <div class="app-icon icon-notes" onclick="alert('Notes App coming soon!')">
                  <i class="fa-solid fa-note-sticky"></i>
                  <div class="app-name">Notes</div>
              </div>
              <div class="app-icon icon-game" onclick="alert('Snake Game coming soon!')">
                  <i class="fa-solid fa-gamepad"></i>
                  <div class="app-name">Game</div>
              </div>
          </div>
      </div>

      <div id="subManager" class="app-view">
          <div class="back-bar"><button class="back-btn" onclick="closeApp()"><i class="fa-solid fa-chevron-left"></i> Back to Apps</button></div>
          <div style="text-align:center; padding:50px;"><h2>Subscription Manager</h2><p>App loaded successfully.</p></div>
      </div>

      <div id="clockApp" class="app-view">
           <div class="back-bar"><button class="back-btn" onclick="closeApp()"><i class="fa-solid fa-chevron-left"></i> Back to Apps</button></div>
           <div style="text-align:center; padding:50px;"><h2>Focus & Clock</h2><p>App loaded successfully.</p></div>
      </div>

      <div id="weatherApp" class="app-view">
           <div class="back-bar"><button class="back-btn" onclick="closeApp()"><i class="fa-solid fa-chevron-left"></i> Back to Apps</button></div>
           
           <div class="weather-container">
              <h2 style="margin-bottom:10px;">Weather Search</h2>
              <div class="search-wrapper">
                  <div class="search-box">
                      <input type="text" id="cityInput" class="weather-input" placeholder="Enter city name (e.g. London)" onkeyup="handleInput(event)">
                      <button class="weather-btn" onclick="getWeather()"><i class="fa-solid fa-search"></i></button>
                  </div>
                  <div id="suggestionsList" class="suggestions-list"></div>
              </div>

              <div id="weatherResult" class="weather-content-grid">
                  <div class="current-weather-card">
                      <div id="wIcon" class="weather-icon"><i class="fa-solid fa-cloud"></i></div>
                      <h3 id="wCity" style="margin:0; font-size:24px;">London</h3>
                      <div id="wTemp" class="weather-temp">15°</div>
                      <div id="wDesc" class="weather-desc">Cloudy</div>
                      <button class="save-city-btn" onclick="saveCurrentCity()">❤️ Save City</button>
                  </div>
                  <div class="forecast-section">
                      <div id="rainAlert" class="rain-alert"><i class="fa-solid fa-umbrella"></i> Rain likely stopping at 14:00</div>
                      <h4 style="font-size:12px; color:#64748b; text-transform:uppercase;">Next 24 Hours</h4>
                      <div id="hourlyScroll" class="hourly-scroll"></div>
                      <h4 style="font-size:12px; color:#64748b; text-transform:uppercase;">3-Day Forecast</h4>
                      <div id="dailyList" class="daily-list"></div>
                  </div>
              </div>

              <div style="margin-top:40px; text-align:center;">
                  <h4 style="color:#64748b; font-size:12px; text-transform:uppercase; letter-spacing:1px; margin-bottom:15px;">Saved Cities</h4>
                  <div id="savedCitiesList" class="saved-cities-list"></div>
              </div>
          </div>
      </div>

  </div>

  <script src="Coursework.js"></script>
  <script>
    // Navigation
    window.openApp = function(appId) { document.getElementById('dashboardView').style.display = 'none'; document.getElementById(appId).style.display = 'block'; window.scrollTo(0,0); };
    window.closeApp = function() { document.querySelectorAll('.app-view').forEach(app => app.style.display = 'none'); document.getElementById('dashboardView').style.display = 'block'; };

    // WEATHER LOGIC
    let savedCities = JSON.parse(localStorage.getItem('sm:savedCities') || '[]');
    let currentCityData = null; let debounceTimer;

    function getWeatherIcon(code) {
        if (code >= 0 && code <= 2) return 'fa-sun'; if (code >= 3 && code <= 48) return 'fa-cloud';
        if (code >= 51 && code <= 67) return 'fa-cloud-rain'; if (code >= 71 && code <= 77) return 'fa-snowflake';
        if (code >= 80 && code <= 82) return 'fa-cloud-showers-heavy'; if (code >= 95) return 'fa-bolt'; return 'fa-cloud';
    }

    function handleInput(event) {
        if (event.key === 'Enter') { getWeather(); document.getElementById('suggestionsList').style.display = 'none'; return; }
        clearTimeout(debounceTimer); debounceTimer = setTimeout(() => { fetchSuggestions(event.target.value); }, 300);
    }

    async function fetchSuggestions(query) {
        const list = document.getElementById('suggestionsList');
        if (query.length < 2) { list.style.display = 'none'; return; }
        try {
            const res = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${query}&count=10&language=en&format=json`);
            const data = await res.json();
            if (data.results) {
                list.innerHTML = ''; list.style.display = 'block'; const seen = new Set();
                data.results.forEach(city => {
                    let displayName = `${city.name}`;
                    if (city.name === "Hong Kong" && (!city.country || city.country_code === "HK")) displayName = "Hong Kong, China";
                    else if (city.name === "Macau" && (!city.country || city.country_code === "MO")) displayName = "Macau, China";
                    else if (city.country) displayName = `${city.name}, ${city.country}`;
                    if (!seen.has(displayName)) {
                        seen.add(displayName);
                        const item = document.createElement('div'); item.className = 'suggestion-item'; item.textContent = displayName;
                        item.onclick = () => { document.getElementById('cityInput').value = city.name; list.style.display = 'none'; getWeatherByCoords(city.latitude, city.longitude, displayName.split(',')[0]); };
                        list.appendChild(item);
                    }
                });
            } else { list.style.display = 'none'; }
        } catch (e) { console.error(e); }
    }
    document.addEventListener('click', function(e) { if (!e.target.closest('.search-wrapper')) document.getElementById('suggestionsList').style.display = 'none'; });

    async function getWeather(cityName = null) {
        const input = document.getElementById('cityInput'); const city = cityName || input.value; if(!city) return;
        try {
            const geoRes = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${city}&count=1&language=en&format=json`);
            const geoData = await geoRes.json(); if(!geoData.results) { alert("City not found"); return; }
            const { latitude, longitude, name } = geoData.results[0]; getWeatherByCoords(latitude, longitude, name); input.value = ''; 
        } catch(e) { console.error(e); }
    }

    async function getWeatherByCoords(lat, lon, name) {
        try {
            const weatherRes = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,weather_code,is_day&hourly=temperature_2m,weather_code,precipitation_probability&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=auto`);
            const wData = await weatherRes.json(); displayFullWeather(name, wData); currentCityData = name; 
        } catch(e) { console.error(e); }
    }

    function displayFullWeather(city, data) {
        document.getElementById('weatherResult').style.display = 'grid'; 
        const current = data.current; if(city === "Hong Kong") city = "Hong Kong"; 
        document.getElementById('wCity').textContent = city; document.getElementById('wTemp').textContent = `${Math.round(current.temperature_2m)}°C`;
        document.getElementById('wIcon').innerHTML = `<i class="fa-solid ${getWeatherIcon(current.weather_code)}"></i>`;
        document.getElementById('wDesc').textContent = getDesc(current.weather_code);
        
        const hScroll = document.getElementById('hourlyScroll'); hScroll.innerHTML = '';
        const currentHour = new Date().getHours();
        for(let i=currentHour; i < currentHour + 24; i++) {
            if(i >= data.hourly.temperature_2m.length) break;
            const temp = Math.round(data.hourly.temperature_2m[i]); const code = data.hourly.weather_code[i];
            hScroll.innerHTML += `<div class="hourly-card"><div style="margin-bottom:5px; font-weight:600;">${i%24}:00</div><i class="fa-solid ${getWeatherIcon(code)}" style="font-size:20px; color:#f59e0b; margin-bottom:5px;"></i><div style="font-weight:700;">${temp}°</div></div>`;
        }
        
        const dList = document.getElementById('dailyList'); dList.innerHTML = '';
        const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        for(let i=0; i<3; i++) {
            const date = new Date(data.daily.time[i]); const dayName = i===0 ? "Today" : days[date.getDay()];
            const min = Math.round(data.daily.temperature_2m_min[i]); const max = Math.round(data.daily.temperature_2m_max[i]);
            dList.innerHTML += `<div class="daily-row"><div style="width:80px;">${dayName}</div><div style="flex:1; text-align:center;"><i class="fa-solid ${getWeatherIcon(data.daily.weather_code[i])}" style="color:#f59e0b;"></i></div><div>${max}° / ${min}°</div></div>`;
        }
    }
    
    function getDesc(code) { if(code <= 2) return "Cloudy/Clear"; if(code <= 67) return "Rainy"; return "Stormy"; }
    function saveCurrentCity() { if(!currentCityData) return; if(!savedCities.includes(currentCityData)) { savedCities.push(currentCityData); localStorage.setItem('sm:savedCities', JSON.stringify(savedCities)); renderSavedCities(); } }
    function deleteCity(city, event) { event.stopPropagation(); savedCities = savedCities.filter(c => c !== city); localStorage.setItem('sm:savedCities', JSON.stringify(savedCities)); renderSavedCities(); }

    async function renderSavedCities() {
        const list = document.getElementById('savedCitiesList'); list.innerHTML = '';
        savedCities.forEach(city => {
            const div = document.createElement('div'); div.className = 'saved-city-card';
            div.onclick = () => getWeather(city);
            div.innerHTML = `<div><div class="saved-city-name">${city}</div></div><div style="display:flex; align-items:center;"><span class="saved-city-temp" id="mini-temp-${city.replace(/\s/g, '')}">--°</span><button class="delete-saved-btn" onclick="deleteCity('${city}', event)"><i class="fa-solid fa-trash"></i></button></div>`;
            list.appendChild(div); fetchMiniTemp(city);
        });
    }
    async function fetchMiniTemp(city) {
        try {
            const geoRes = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${city}&count=1&language=en&format=json`); const geoData = await geoRes.json();
            if(!geoData.results) return; const { latitude, longitude } = geoData.results[0];
            const wRes = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current_weather=true`); const wData = await wRes.json();
            const tempEl = document.getElementById(`mini-temp-${city.replace(/\s/g, '')}`); if(tempEl) tempEl.textContent = `${Math.round(wData.current_weather.temperature)}°`;
        } catch(e) {}
    }
    renderSavedCities();
  </script>
</body>
</html>
