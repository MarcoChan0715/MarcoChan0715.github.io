<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Subscription Manager - Marco's Site</title>

  <!-- Your site CSS first -->
  <link rel="stylesheet" href="Coursework.css" />

  <!-- Fonts (optional) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- App styles: placed AFTER Coursework.css so these take precedence -->
  <style>
    /* Scope everything under #sm so global rules won’t leak */
    #sm, #sm * { box-sizing: border-box; font-family: 'Poppins', system-ui, Arial, sans-serif; }

    /* Page background spacing (keeps your banner) */
    #sm {
      padding: 24px 16px 48px;
      background: #f6f7f9;
    }

    /* Layout container */
    #sm .sm-container {
      max-width: 1000px;
      margin: 0 auto;
    }

    /* Headings (override any huge global h1/h2) */
    #sm h1 {
      margin: 0 0 16px;
      font-weight: 700;
      line-height: 1.2;
      font-size: clamp(28px, 4.2vw, 48px);
      text-align: center;
      color: #111827;
    }
    #sm h2 {
      margin: 0 0 12px;
      font-weight: 600;
      line-height: 1.3;
      font-size: clamp(18px, 2.4vw, 24px);
      color: #111827;
    }

    /* Card */
    #sm .sm-card {
      background: #fff;
      border-radius: 12px;
      padding: 18px;
      margin: 14px 0;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      border: 1px solid #e5e7eb;
    }

    /* Inputs */
    #sm .sm-row { display: flex; gap: 10px; flex-wrap: wrap; }
    #sm .sm-input, #sm .sm-select {
      appearance: none;
      -webkit-appearance: none;
      border: 1px solid #d1d5db;
      border-radius: 10px;
      padding: 10px 12px;
      font-size: 16px;
      background: #fff;
      color: #111827;
      min-width: 180px;
      flex: 1 1 220px;
      outline: none;
    }
    #sm .sm-input:focus, #sm .sm-select:focus {
      border-color: #818cf8;
      box-shadow: 0 0 0 3px rgba(129,140,248,.25);
    }

    /* Buttons */
    #sm .sm-btn {
      border: 0;
      border-radius: 10px;
      padding: 10px 14px;
      cursor: pointer;
      font-weight: 600;
      font-size: 15px;
    }
    #sm .sm-btn-primary { background: #6366f1; color: #fff; }
    #sm .sm-btn-danger { background: #ef4444; color: #fff; }

    /* Subscription list */
    #sm .sm-sub {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      padding: 10px 0;
      border-bottom: 1px solid #e5e7eb;
    }
    #sm .sm-sub:last-child { border-bottom: 0; }
    #sm .sm-sub-name { font-weight: 600; color: #111827; }
    #sm .sm-sub-meta { color: #6b7280; font-size: 14px; }

    /* Totals */
    #sm .sm-totals strong { color: #111827; }
    #sm .sm-amount { font-weight: 700; color: #111827; }

    /* Upcoming card */
    #sm .sm-upcoming-title { display:flex; align-items:center; justify-content:space-between; margin-bottom:8px; }
    #sm .sm-chip {
      display:inline-flex; align-items:center; gap:6px;
      padding:4px 10px; border-radius:999px; font-size:12px; font-weight:600;
      background:#FEF3C7; color:#92400E; border:1px solid #FDE68A;
    }
    #sm .sm-up-empty { color:#6b7280; font-size:14px; }

    /* Make sure images/iframes don’t overflow */
    #sm img, #sm iframe { max-width: 100%; display: block; }
  </style>
</head>
<body>

  <!-- Your existing banner + navbar (copied from your pages) -->
  <section id="banner">
    <a href="index.html">
      <img src="images/Coursework/Untitled_Artwork.png" width="350" height="150" class="logo" alt="Logo">
    </a>
    <div class="navbar">
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="Hobbies.html">Hobbies</a></li>
        <li><a href="Video.html">Video</a></li>
        <li><a href="app.html">App</a></li>
        <li><a href="Clock.html">Clock</a></li>
      </ul>
    </div>
  </section>

  <!-- Subscription Manager (scoped) -->
  <main id="sm">
    <div class="sm-container">
      <h1>Subscription Manager</h1>

      <!-- Upcoming payment -->
      <section class="sm-card" id="sm-upcoming">
        <div class="sm-upcoming-title">
          <h2 style="margin:0;">Upcoming payment</h2>
          <span class="sm-chip">Happening soon</span>
        </div>
        <div id="sm-up-body" class="sm-up-empty">No upcoming payments yet. Add a subscription below and we’ll show the next renewal here.</div>
      </section>

      <!-- Add form -->
      <section class="sm-card">
        <h2>Add a Subscription</h2>
        <div class="sm-row" style="margin-bottom:10px;">
          <input id="sm-name" class="sm-input" type="text" placeholder="Name (e.g., Netflix)">
          <input id="sm-cost" class="sm-input" type="number" inputmode="decimal" placeholder="Cost (e.g., 9.99)">
          <select id="sm-cycle" class="sm-select">
            <option value="monthly">Monthly</option>
            <option value="yearly">Yearly</option>
          </select>
          <input id="sm-start" class="sm-input" type="date" />
        </div>
        <button id="sm-add" class="sm-btn sm-btn-primary">Add</button>
      </section>

      <!-- Totals -->
      <section class="sm-card sm-totals" id="sm-totals">
        <div><strong>Monthly Total:</strong> <span id="sm-monthly" class="sm-amount">$0.00</span></div>
        <div style="margin-top:6px;"><strong>Yearly Total:</strong> <span id="sm-yearly" class="sm-amount">$0.00</span></div>
      </section>

      <!-- List -->
      <section class="sm-card">
        <h2>Active Subscriptions</h2>
        <div id="sm-list"></div>
      </section>
    </div>
  </main>

  <!-- App script -->
  <script>
    (function(){
      const $ = (id) => document.getElementById(id);

      // Load / save localStorage
      function load() {
        try { return JSON.parse(localStorage.getItem("subs_v1") || "[]"); }
        catch { return []; }
      }
      function save(data) {
        localStorage.setItem("subs_v1", JSON.stringify(data));
      }

      let subs = load();

      // Dates helpers
      function parseISO(s){ const d=new Date(s); return isNaN(d.getTime())?null:d; }
      function addMonths(d,n){ const r=new Date(d); r.setMonth(r.getMonth()+n); return r; }
      function addYears(d,n){ const r=new Date(d); r.setFullYear(r.getFullYear()+n); return r; }
      function nextRenewal(startISO, cycle){
        const start = parseISO(startISO); if(!start) return null;
        const now = new Date();
        if(cycle === 'monthly'){ let dt = new Date(start); while(dt <= now) dt = addMonths(dt,1); return dt; }
        let dt = new Date(start); while(dt <= now) dt = addYears(dt,1); return dt;
      }
      function daysUntil(date){
        if(!date) return null;
        const ms = date.getTime() - Date.now();
        return Math.ceil(ms/86400000);
      }
      function fmtMoney(n){ return "$" + Number(n).toFixed(2); }

      // Render everything
      function render() {
        // list + totals
        const list = $("sm-list");
        list.innerHTML = "";
        let monthly = 0, yearly = 0;

        subs.forEach((s, i) => {
          const nr = nextRenewal(s.start, s.cycle);
          const d = daysUntil(nr);
          const row = document.createElement("div");
          row.className = "sm-sub";
          row.innerHTML = `
            <div>
              <div class="sm-sub-name">${s.name}</div>
              <div class="sm-sub-meta">$${s.cost} / ${s.cycle}${nr ? ` • next: ${nr.toLocaleDateString()}${d!=null? ` • in ${d} days` : ""}` : ""}</div>
            </div>
            <button class="sm-btn sm-btn-danger" data-del="${i}">Delete</button>
          `;
          list.appendChild(row);

          if (s.cycle === "monthly") { monthly += s.cost; yearly += s.cost * 12; }
          else { yearly += s.cost; monthly += s.cost / 12; }
        });

        $("sm-monthly").textContent = fmtMoney(monthly);
        $("sm-yearly").textContent = fmtMoney(yearly);
        save(subs);

        // upcoming
        const up = $("sm-up-body");
        if(subs.length === 0){
          up.className = "sm-up-empty";
          up.textContent = "No upcoming payments yet. Add a subscription below and we’ll show the next renewal here.";
          return;
        }
        const withDates = subs.map(s => ({...s, nr: nextRenewal(s.start, s.cycle)}))
                              .filter(x => !!x.nr)
                              .sort((a,b)=> a.nr.getTime()-b.nr.getTime());
        if(withDates.length === 0){
          up.className = "sm-up-empty";
          up.textContent = "No upcoming payments yet.";
          return;
        }
        const n = withDates[0];
        const dleft = daysUntil(n.nr);
        up.className = "";
        up.innerHTML = `
          <div style="display:flex;align-items:flex-start;justify-content:space-between;gap:12px;">
            <div>
              <div style="font-weight:700;color:#111827;margin-bottom:2px;">${n.name}</div>
              <div style="color:#6b7280;font-size:14px;">
                Due ${n.nr.toLocaleDateString()}${dleft!=null? ` • in ${dleft} days` : ""} • ($${n.cost.toFixed(2)}, ${n.cycle})
              </div>
            </div>
            <div style="text-align:right;">
              <div style="color:#6b7280;font-size:12px;">Amount</div>
              <div style="font-weight:700;color:#111827;">${fmtMoney(n.cycle==='monthly'? n.cost : n.cost)}</div>
            </div>
          </div>
        `;
      }

      function add() {
        const name = $("sm-name").value.trim();
        const costStr = $("sm-cost").value.trim();
        const cycle = $("sm-cycle").value;
        const start = $("sm-start").value || new Date().toISOString().slice(0,10);
        // allow empty field to be blank; only validate on add
        const cost = parseFloat(costStr);
        if (!name || !isFinite(cost)) {
          alert("Please enter a name and a valid cost.");
          return;
        }
        subs.unshift({ name, cost, cycle, start });
        $("sm-name").value = "";
        $("sm-cost").value = "";
        $("sm-start").value = "";
        render();
      }

      // default date = today
      $("sm-start").value = new Date().toISOString().slice(0,10);

      // Events
      $("sm-add").addEventListener("click", add);
      $("sm-list").addEventListener("click", (e) => {
        const btn = e.target.closest("button[data-del]");
        if (!btn) return;
        const idx = parseInt(btn.getAttribute("data-del"), 10);
        subs.splice(idx, 1);
        render();
      });

      // First paint
      render();
    })();
  </script>
</body>
</html>

